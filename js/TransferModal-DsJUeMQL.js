import{a as A,c as M,r as n,j as e,w as V,B as W}from"../index-JdCxlw3t.js";import{B as b}from"./big-Bray3y5Z.js";import{P as w}from"./PpToken-C3PFjwHo.js";import{V as N}from"./Vault-ouJkiFSs.js";import{t as f}from"./toFixed-C6TjCq0V.js";import{u as G}from"./useTranslation-Cpp1qrkX.js";import{u as S}from"./useWriteContract-Sjkp5ElZ.js";import{f as L,u as _,a as z}from"./useChainId-sKlV8ELp.js";import{w as J}from"./waitForTransactionReceipt-DtMnh93M.js";import{f as D}from"./call-DYnlgnIr.js";import{p as I}from"./parseEther-B3o0bX_6.js";import{r as X}from"./readContracts-7nfeNzIE.js";import"./writeContract-CTM5bh4u.js";import"./getTransactionReceipt-fHZaxSzl.js";function Y(t,r={}){return{async queryFn({queryKey:o}){const{hash:a,...i}=o[1];if(!a)throw new Error("hash is required");return J(t,{...i,onReplaced:r.onReplaced,hash:a})},queryKey:Z(r)}}function Z(t={}){const{onReplaced:r,...o}=t;return["waitForTransactionReceipt",L(o)]}function k(t={}){const{hash:r,query:o={}}=t,a=A(t),i=_({config:a}),l=Y(a,{...t,chainId:t.chainId??i}),p=!!(r&&(o.enabled??!0));return z({...o,...l,enabled:p})}const fe=({lastPrice:t,maxAmount:r,open:o,onClose:a,onSubmitted:i})=>{const{t:l}=G(),p=A(),{address:u}=M(),{writeContract:C}=S(),[P,j]=n.useState(),{data:g}=k({hash:P}),{writeContract:U}=S(),[q,y]=n.useState(),{data:v}=k({hash:q}),[d,H]=n.useState({balance:0,allowance:0}),[c,T]=n.useState(""),[B,m]=n.useState(!1),E=b(t).div(10).toFixed(),x=+c>0?b(c).mul(E).toFixed():"-",R=Number(c),Q=R<=0||R>d.balance||Number(x)>Number(r)||B;n.useEffect(()=>{h()},[u]),n.useEffect(()=>{g&&(d.allowance>=Number(c)?(F(),j(void 0)):h())},[g,d,c]),n.useEffect(()=>{v&&(h(),T(""),m(!1),i==null||i(),a==null||a(),y(void 0))},[v]);const h=n.useCallback(async()=>{if(u){const[{result:s},{result:K}]=await X(p,{contracts:[{...w,functionName:"balanceOf",args:[u]},{...w,functionName:"allowance",args:[u,N.address]}]});H({balance:Number(D(s??0n)),allowance:Number(D(K??0n))})}},[u]),O=()=>{C({...w,functionName:"approve",args:[N.address,BigInt(b(2).pow(256).sub(1).toFixed())]},{onSuccess(s){j(s)},onError(s){console.log(s),m(!1)}})},F=()=>{if(m(!0),d.allowance<Number(c))return O();U({...N,functionName:"sell",args:[I(c),I(x)]},{onSuccess(s){y(s)},onError(s){m(!1),console.log(s)}})};return e.jsxs(V,{closeBtn:!0,title:"Transfer PR",open:o,onClose:a,children:[e.jsxs("div",{className:"mt-8 grid grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-2xl text-white",children:[e.jsx("span",{className:"font-semibold text-[32px]/10",children:f(E)})," ","USDT"]}),e.jsx("span",{className:"mt-1 text-[#B8B8B8] text-xs",children:l("Recycled price")})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-2xl text-white",children:[e.jsx("span",{className:"font-semibold text-[32px]/10",children:f(r)})," ","USDT"]}),e.jsx("span",{className:"mt-1 text-[#B8B8B8] text-xs",children:l("Amount left")})]})]}),e.jsx("input",{type:"number",placeholder:l("Transfer amount"),className:"mt-8 rounded border border-white/60 bg-[#080E2A] px-3 py-[10px] text-base text-white outline-none transition placeholder:text-[#8E8E8E] focus:border-white",value:c,onChange:s=>T(s.target.value)}),e.jsxs("div",{className:"mt-8 text-sm text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:l("PR amount left")}),e.jsx("span",{className:"font-semibold",children:f(d.balance)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{children:l("USDT getting back")}),e.jsx("span",{className:"font-semibold",children:f(x)})]})]}),e.jsx(W,{type:"secondary",text:"Confirm",className:"mt-8 w-full",disabled:Q,isLoading:B,onClick:F})]})};export{fe as default};
